# 第 17.9 节 AList

需要编译安装。

- 功能请求：做成 Port。


```sh
# pkg install -y node wget curl git go122 gcc bash gawk gsed
# ln -s /usr/local/bin/go122 /usr/local/bin/go
# git clone  https://github.com/alist-org/alist
# cd alist/public && wget https://github.com/alist-org/alist-web/releases/latest/download/dist.tar.gz && tar xzf # # # dist.tar.gz && rm dist.tar.gz
# cd ..
```

`ee 1.sh`，写入：

```bash
appName="alist"
builtAt="$(date +'%F %T %z')"
goVersion=$(go version | sed 's/go version //')
gitAuthor=$(git show -s --format='format:%aN <%ae>' HEAD)
gitCommit=$(git log --pretty=format:"%h" -1)
version=$(git describe --long --tags --dirty --always)
webVersion=$(wget -qO- -t1 -T2 "https://api.github.com/repos/alist-org/alist-web/releases/latest" | grep "tag_name" | head -n 1 | awk -F ":" '{print $2}' | sed 's/\"//g;s/,//g;s/ //g')
ldflags="\
-w -s \
-X 'github.com/alist-org/alist/v3/internal/conf.BuiltAt=$builtAt' \
-X 'github.com/alist-org/alist/v3/internal/conf.GoVersion=$goVersion' \
-X 'github.com/alist-org/alist/v3/internal/conf.GitAuthor=$gitAuthor' \
-X 'github.com/alist-org/alist/v3/internal/conf.GitCommit=$gitCommit' \
-X 'github.com/alist-org/alist/v3/internal/conf.Version=$version' \
-X 'github.com/alist-org/alist/v3/internal/conf.WebVersion=$webVersion' \
"
go build -ldflags="$ldflags" .
```

进行编译：

```bash
bash 1.sh
```

编译后的文件在 `alist` 下。`与 1.sh` 位于统一路径下。

配置：

```sh
./alist admin set 1 #设置 admin 密码为 1
./alist serve #启动
```

## 指定 vlc 为 AList 的外部播放器

AList 中的内嵌播放器有时不能播放某些视频，但 AList 可以通过 URI 调用外部程序（通过 `xdg-open` )。AList 为 vlc 指定的视频地址形如 `vlc://http://xxx`，只要为 `vlc://` 开头的 URI 指定 vlc 程序即可。

`xdg-open` 向 vlc 传递 URI 时会包含 `vlc://` , vlc 不能打开这样的地址，需要在打开视频地址前先去除，然后调用 vlc，下面是要调用的脚本：

```sh
safreya ~ % cat ~/.local/share/applications/vlc-noschema.sh
#!/bin/sh
url="$1"
clean_url="${url#vlc://}"           # 去除 vlc:// 头
vlc "$clean_url"
```

增加执行权限

```sh
$ chmod u+x ~/.local/share/applications/vlc-noschema.sh
```

新建 `.desktop` 文件，以便 xdg-open 调用上面的脚本：

```sh
safreya ~ % cat ~/.local/share/applications/userapp-vlc.desktop
[Desktop Entry]
Encoding=UTF-8
Version=1.0
Type=Application
NoDisplay=true
Exec=/home/safreya/.local/share/applications/vlc-noschema.sh %U
Name=vlc
Comment=Custom definition for vlc
```

注册 `vlc://` URI 的调用程序

```sh
$ update-desktop-database ~/.local/share/applications
$ xdg-mime default userapp-vlc.desktop x-scheme-handler/vlc

## 参考文献

- [ansoncloud8/am-alist-freebsd](https://github.com/ansoncloud8/am-alist-freebsd/blob/main/.github/workflows/build.yml)，直接使用会报错版本不对
- [从源码运行](https://alist.nn.ci/zh/guide/install/source.html)，官方文档
